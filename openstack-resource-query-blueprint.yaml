tosca_definitions_version: cloudify_dsl_1_3

imports:
  - http://www.getcloudify.org/spec/cloudify/4.0.1/types.yaml
  - https://raw.githubusercontent.com/MichaelShn/cloudify-openstack-plugin/master/plugin.yaml


dsl_definitions:

  openstack_config: &openstack_config
    username: { get_secret: keystone_username }
    password: { get_secret: keystone_password }
    tenant_name: { get_secret: keystone_tenant_name }
    auth_url: { get_secret: keystone_url }
    region: { get_secret: region }


node_templates:

  OpenstackQuery:
    type: cloudify.openstack.nodes.Limits:
    properties:
      openstack_config: *openstack_config

outputs:
  visual_outputs:
    description: Openstack Resources Status
    value:
      - type: gauge
        name: CPU
        description: "cpu usage"
        min: 0
        max: 100
        value: 75

      - type: gauge
        name: RAM
        description: "Memory usage"
        min: 0
        max: 100
        value: 75

      - type: gauge
        name: Instances
        description: "Active Instances"
        min: 0
        max: 100
        value: 75

      - type: workflow-select
        name: Default Tenant
        workflow: refresh

      - type: workflow-select
        name: Tenant A
        workflow: refresh_a

      - type: workflow-select
        name: Tenant B
        workflow: refresh_b

      - type: workflow-button
        name: Refresh
